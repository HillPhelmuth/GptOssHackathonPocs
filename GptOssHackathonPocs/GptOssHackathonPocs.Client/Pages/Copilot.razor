@page "/copilot"
@using GptOssHackathonPocs.Core.Models
@using GptOssHackathonPocs.Core.Services
@inject IncidentAggregator Aggregator
@inject IJSRuntime JS

<TriageDashboard></TriageDashboard>
@* <h3>Rapid-Response Triage (POC)</h3>

<button class="btn btn-primary" @onclick="Refresh">Refresh</button>

<div class="row mt-3">
  <div class="col-5" style="max-height:80vh;overflow:auto">
    <ul class="list-group">
      @if (_incidents is null)
      {
        <li class="list-group-item">No data yet.</li>
      }
      else
      {
        @foreach (var i in _incidents)
        {
          <li class="list-group-item">
            <strong>@i.Title</strong>
            <div><small>@i.Source • @i.Timestamp.UtcDateTime.ToString("u") • @i.Severity</small></div>
            <div class="text-muted">@i.Description</div>
            @if (!string.IsNullOrWhiteSpace(i.Link))
            {
                <div><a href="@i.Link" target="_blank">Source</a></div>
            }
            <div>@i.GeoJson</div>
            <div class="mt-1">
              <em>Suggested action:</em> @SuggestAction(i)
            </div>
          </li>
        }
      }
    </ul>
  </div>
  <div class="col-7">
    <div id="map" style="height:70vh;border-radius:12px;border:1px solid #ddd;"></div>

    <div class="mt-3">
      <div class="d-flex gap-2">
        <button class="btn btn-success" @onclick="GenerateActionPlan">Generate Action Plan</button>
        <button class="btn btn-outline-danger" @onclick="CancelGeneration">Cancel</button>
      </div>
      @if (!string.IsNullOrWhiteSpace(_actionPlanMarkdown))
      {
        <div class="mt-2 border rounded p-3" style="max-height:70vh;overflow:auto;">
          @((MarkupString)MarkdownAsHtml(_actionPlanMarkdown))
        </div>
      }
    </div>
  </div>
</div> *@