@using GptOssHackathonPocs.Core.Models
@using GptOssHackathonPocs.Core.Services

<div class="td-container">
    <div class="td-row">
        <div class="td-main">
            <div class="td-tabs" role="tablist" style="position:relative">
                <button class="td-btn" style="position:absolute; left:8px; top:4px;" @onclick="@(() => Nav.NavigateTo(""))">Home</button>
                <button class="@ActiveTabClass(Tab.Map)" @onclick="() => SetTab(Tab.Map)">Incident Map</button>
                <button class="@ActiveTabClass(Tab.Feeds)" @onclick="() => SetTab(Tab.Feeds)">Data Feeds</button>
                <button class="@ActiveTabClass(Tab.Comm)" @onclick="() => SetTab(Tab.Comm)">Communications</button>
                <button class="td-btn" style="position:absolute; right:8px; top:4px;" @onclick="@(() => Refresh())">Refresh</button>
            </div>
            <div class="td-tabpanes">
                @switch (_activeTab)
                {
                    case Tab.Map:
                        <div class="td-pane">
                            <IncidentMap Incidents="@_incidents" IncidentSelected="SelectIncident" />
                            
                        </div>
                        break;
                    case Tab.Feeds:
                        <div class="td-pane">
                            <DataFeedsList  Incidents="@_incidents" />
                        </div>
                        break;
                    case Tab.Comm:
                        <div class="td-pane">
                            <CommunicationsHub OnChannelClicked="OnChannel" OnSendQuickMessage="OnQuickMessage" />
                        </div>
                        break;
                }
                <div class="td-block-gap"></div>
                @* <ActionQueue Items="@_queue" OnStatusChanged="OnActionStatusChanged" /> *@
                <label>
                    View Incident:
                    <select style="max-width:15rem" @onchange="HandleSelectChange">
                        @foreach (var inc in _incidents ?? [])
                        {
                            <option value="@inc.Id">@inc.Title</option>
                        }
                    </select>
                </label>
                <IncidentDetailsPanel Incident="@_selected" PopulationAffected="@(_selectedCard?.PopulationExposed ?? 0.0)" SviPercentile="@(_selectedCard?.SviPercentile ?? 0.0)"/>
            </div>
        </div>
        <div class="td-side">
           
            <ActionQueue Items="@_queue" OnStatusChanged="OnActionStatusChanged" />
        </div>
    </div>

    @if (_isBusy)
    {
        <div class="td-busy-backdrop" role="dialog" aria-modal="true" aria-live="polite">
            <div class="td-busy-card" @onclick:stopPropagation>
                <div class="td-busy-row">
                    <div class="td-spinner" aria-hidden="true"></div>
                    <div class="td-busy-text">@_busyText</div>
                </div>
            </div>
        </div>
    }
</div>