@using GptOssHackathonPocs.Core.Models
@using GptOssHackathonPocs.Core.Services

<div class="td-container">
    <div class="td-row">
        <div class="td-main">
            <div class="td-tabs" role="tablist" style="position:relative"> 
                <button class="@ActiveTabClass(Tab.Map)" @onclick="() => SetTab(Tab.Map)">Incident Map</button>
                <button class="@ActiveTabClass(Tab.Feeds)" @onclick="() => SetTab(Tab.Feeds)">Data Feeds</button>
                <button class="@ActiveTabClass(Tab.Comm)" @onclick="() => SetTab(Tab.Comm)">Communications</button>
                <button class="td-tab active" style="position:absolute; right:8px; top:4px;" @onclick="@(()=> Refresh())">Refresh</button>
            </div>
            <div class="td-tabpanes">
                @switch (_activeTab)
                {
                    case Tab.Map:
                        <div class="td-pane">
                            <IncidentMap Incidents="@_incidents" />
                            
                        </div>
                        break;
                    case Tab.Feeds:
                        <div class="td-pane">
                            <DataFeedsList />
                        </div>
                        break;
                    case Tab.Comm:
                        <div class="td-pane">
                            <CommunicationsHub OnChannelClicked="OnChannel" OnSendQuickMessage="OnQuickMessage" />
                        </div>
                        break;
                }
                <div class="td-block-gap"></div>
                <ActionQueue Items="@_queue" OnStatusChanged="OnActionStatusChanged" />
            </div>
        </div>
        <div class="td-side">
            <IncidentDetailsPanel Incident="@_selected" />
            <select style="max-width:10rem" @onchange="@((e) => _selected = _incidents.First(x => x.Id == e.Value.ToString()))">
                @foreach(var inc in _incidents ?? [])
                {
                    <option value="@inc.Id">@inc.Title</option>
                }
            </select>
        </div>
    </div>
</div>